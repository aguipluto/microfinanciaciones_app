<% provide(:title, 'Editar Perfil') %>


<div class="row">
  <div class="col-md-6 col-md-offset-3">
    <h2>Pefil de Usuario</h2>
  </div>
</div>
<div class="row">
  <ul class="col-md-3 nav nav-pills nav-stacked">
    <li id="menuIzqPerfil" class="active"><a href="#">Perfil</a></li>
    <li id="menuIzqEditar"><a href="#">Editar Perfil</a></li>
    <li id="menuIzqPagos"><a href="#">Aportaciones Realizadas</a></li>
  </ul>

  <div id="perfilDeUsuario" class="col-md-7">
    <%= form_for(@user, html: {class: "col-md-9 form"}) do |f| %>
        <div class="form-group">
          <label class="control-label">Nombre</label>

          <p class="form-control-static"><%= @user.name %></p>
        </div>
        <div class="form-group">
          <label class="control-label">Apellidos</label>

          <p class="form-control-static"><%= @user.family_name %></p>
        </div>
        <div class="form-group">
          <label class="control-label">Email</label>

          <p class="form-control-static"><%= @user.email %></p>
        </div>
        <% if @user.nif %>
            <div class="form-group">
              <label class="control-label">NIF/DNI</label>

              <p class="form-control-static"><%= @user.nif %></p>
            </div>
        <% end %>
        <div class="form-group">
          <label class="control-label">Fecha de nacimiento</label>

          <p class="form-control-static"><%= @user.birthdate %></p>
        </div>
    <% end %>
    <div class="col-md-3">
      <%= image_tag @user.avatar.url(:thumb), class: "img-thumbnail" %>
    </div>
  </div>

  <div id="editarPerfilDeUsuario" class="col-md-7 well hidden">
    <%= form_for(@user, html: {id: "formulario-editar", class: "col-md-9 form"}) do |f| %>
        <%= render 'shared/error_messages', object: f.object %>
        <div class="form-group">
          <%= f.label :avatar, class: "control-label" %>
          <br/>
          <%= f.file_field :avatar, class: "form-control" %>
        </div>
        <div class="form-group">
          <%= f.label :name, "Nombre", class: "control-label" %>
          <%= f.text_field :name, class: "form-control", placeholder: "Nombre" %>
        </div>
        <div class="form-group">
          <%= f.label :family_name, "Apellidos", class: "control-label" %>
          <%= f.text_field :family_name, class: "form-control", placeholder: "Apellidos" %>
        </div>
        <div class="form-group">
          <%= f.label :email, class: "control-label" %>
          <%= f.text_field :email, class: "form-control", placeholder: "Email" %>
        </div>
        <div class="form-group">
          <%= f.label :nif, 'NIF/DNI', class: "control-label" %>
          <%= f.text_field :nif, class: "form-control", placeholder: "NIF/DNI" %>
        </div>
        <div class="form-group">
          <%= f.label :birthdate, "Fecha de nacimiento", class: "control-label" %>
          <div class="date row">
            <%= f.date_select :birthdate, {:order => [:day, :month, :year], :start_year => 1910, :end_year => 2012}, {:class => 'date-select form-control'} %>
          </div>
        </div>
        <div id="div_change_password" class="hidden">
          <div class="form-group">
            <%= f.label :password, "Contraseña", class: "control-label" %>
            <%= f.password_field :password, class: "form-control", placeholder: "Contraseña" %>
          </div>
          <div class="form-group">
            <%= f.label :password_confirmation, "Repita contraseña", class: "control-label" %>
            <%= f.password_field :password_confirmation, class: "form-control", placeholder: "Repita contraseña" %>
          </div>
        </div>
        <% if current_user.admin? %>
            <div class="checkbox">
              <label>
                <%= f.check_box :admin %> Administrador</a>
              </label>
            </div>
        <% end %>
        <div class="form-group">
          <%= f.submit "Guardar cambios", class: "btn btn-primary" %>
          <button id="change_password" class="btn btn-default">Cambiar contraseña</button>
        </div>
    <% end %>
    <div class="col-md-3">
      <%= image_tag @user.avatar.url(:thumb), class: "img-thumbnail" %>
    </div>
  </div>

  <div id="aportacionesRealizadas" class="col-md-7 hidden">
    <table class="table table-hover">
      <thead>
      <tr>
        <th>
          Proyecto
        </th>
        <th>
          Aportación
        </th>
        <th>
          Fecha de colaboración
        </th>
      </tr>
      </thead>
      <% @user.purchased_cart_items.each do |ci| %>
          <% if ci.proyecto %>
              <tr>
                <td><%= link_to ci.proyecto.titulo, ci.proyecto %></td>
                <td><%= ci.aportacion %> &euro;</td>
                <td><%= ci.cart.purchased_at.strftime("%d/%m/%Y %H:%M") %></td>
              </tr>
          <% end %>
      <% end %>
    </table>
  </div>
</div>