<% provide(:title, 'Editar Perfil') %>


<div class="row">
  <div class="col-sm-6 col-sm-offset-3">
    <h2>Pefil de Usuario</h2>
  </div>
</div>

<div class="row">
  <ul class="col-sm-3 nav nav-pills nav-stacked">
    <li id="menuIzqPerfil" class="active"><a href="#">Perfil</a></li>
    <li id="menuIzqEditar"><a href="#">Editar Perfil</a></li>
    <li id="menuIzqCambiar"><a href="#">Cambiar contraseña</a></li>
    <li id="menuIzqPagos"><a href="#">Aportaciones Realizadas</a></li>
  </ul>

  <div id="perfilDeUsuario" class="col-sm-7">
    <%= form_for(@user, html: {class: "col-sm-9 form"}) do |f| %>
        <div class="form-group">
          <label class="control-label">Nombre</label>

          <p class="form-control-static"><%= @user.name %></p>
        </div>
        <div class="form-group">
          <label class="control-label">Apellidos</label>

          <p class="form-control-static"><%= @user.family_name %></p>
        </div>
        <div class="form-group">
          <label class="control-label">Email</label>

          <p class="form-control-static"><%= @user.email %></p>
        </div>
        <% if @user.nif %>
            <div class="form-group">
              <label class="control-label">NIF/DNI</label>

              <p class="form-control-static"><%= @user.nif %></p>
            </div>
        <% end %>
        <div class="form-group">
          <label class="control-label">Fecha de nacimiento</label>

          <p class="form-control-static"><%= @user.birthdate.strftime("%d/%m/%Y") %></p>
        </div>
    <% end %>
    <div class="col-sm-3">
      <%= image_tag @user.image_url.to_s, class: "img-thumbnail" %>
    </div>
    <div class="col-sm-3">
      <p class="text-center">
        <% if @user.admin? %>
            <span class="label label-info">Administrador</span>
        <% end %>
        <% if @user.blog_editor? %>
        <span class="label label-info">Editor del Blog</span>
        <% end %>
      </p>
    </div>
  </div>

  <div id="editarPerfilDeUsuario" class="col-sm-7 well hidden">
    <%= form_for(@user, remote: false, html: {id: "formulario-editar", multipart: true, class: "col-sm-9 form"}) do |f| %>
        <%= render 'shared/error_messages', object: f.object %>
        <div class="form-group">
          <%= f.label :image, class: "control-label" %>
          <br/>
          <%= f.file_field :image, class: "form-control", accept: 'image/png,image/gif,image/jpeg,image/jpg' %>
        </div>
        <div class="form-group">
          <%= f.label :name, "Nombre", class: "control-label" %>
          <%= f.text_field :name, class: "form-control", placeholder: "Nombre" %>
        </div>
        <div class="form-group">
          <%= f.label :family_name, "Apellidos", class: "control-label" %>
          <%= f.text_field :family_name, class: "form-control", placeholder: "Apellidos" %>
        </div>
        <div class="form-group">
          <%= f.label :email, class: "control-label" %>
          <%= f.text_field :email, class: "form-control", placeholder: "Email" %>
        </div>
        <div class="form-group">
          <%= f.label :nif, 'NIF/DNI', class: "control-label" %>
          <%= f.text_field :nif, class: "form-control", placeholder: "NIF/DNI" %>
        </div>
        <div class="form-group">
          <%= f.label :birthdate, "Fecha de nacimiento", class: "control-label" %>
          <div class="date row">
            <%= f.date_select :birthdate, {:order => [:day, :month, :year], :start_year => 1910, :end_year => 2012}, {:class => 'date-select form-control'} %>
          </div>
        </div>
        <% if current_user.admin? %>
            <div class="form-inline">
              <div class="checkbox">
                <label>
                  <%= f.check_box :admin %> Administrador</a>
                </label>
              </div>
              <div class="checkbox">
                <label>
                  <%= f.check_box :blog_editor %> Editor del Blog</a>
                </label>
              </div>
            </div>
        <% end %>
        <br>

        <div class="form-group">
          <%= f.submit "Guardar cambios", class: "btn btn-primary" %>
        </div>
    <% end %>
    <div class="col-sm-3">
      <%= image_tag @user.image_url.to_s, class: "img-thumbnail" %>
    </div>
  </div>

  <div id="changePassword" class="col-sm-7 well hidden">
    <%= form_for(@user, remote: false, html: {id: "formulario-editar", multipart: true, class: "col-sm-9 form"}) do |f| %>
        <%= render 'shared/error_messages', object: f.object %>
        <div class="form-group">
          <%= f.label :password, "Nueva contraseña", class: "control-label" %>
          <%= f.password_field :password, class: "form-control", placeholder: "Contraseña" %>
        </div>
        <div class="form-group">
          <%= f.label :password_confirmation, "Repita nueva contraseña", class: "control-label" %>
          <%= f.password_field :password_confirmation, class: "form-control", placeholder: "Repita nueva contraseña" %>
        </div>
        <div class="form-group">
          <%= f.submit "Cambiar contraseña", class: "btn btn-primary" %>
        </div>
    <% end %>
  </div>

  <div id="aportacionesRealizadas" class="col-sm-7 hidden">
    <table class="table table-hover">
      <thead>
      <tr>
        <th>
          Proyecto
        </th>
        <th>
          Aportación
        </th>
        <th>
          Fecha de colaboración
        </th>
      </tr>
      </thead>
      <% @user.purchased_cart_items.each do |ci| %>
          <% if ci.proyecto %>
              <tr>
                <td><%= link_to ci.proyecto.titulo, ci.proyecto %></td>
                <td><%= ci.aportacion %> &euro;</td>
                <td><%= ci.cart.purchased_at.strftime("%d/%m/%Y %H:%M") %></td>
              </tr>
          <% end %>
      <% end %>
    </table>
  </div>

</div>